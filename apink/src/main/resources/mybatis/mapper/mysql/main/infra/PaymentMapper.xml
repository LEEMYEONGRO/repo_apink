<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.blackpink.infra.payment.PaymentDao">

	<resultMap id="resultMapObj" type="com.blackpink.infra.payment.PaymentDto"></resultMap>

	<sql id ="selectCommon">
		FROM member a
			JOIN payment b 
			 on b.mbSeq = a.mbSeq 
			JOIN productpayment c 
			 on c.pmSeq = b.pmSeq
			JOIN product d 
			 on d.pdSeq = c.pdSeq
		WHERE
			 a.mbSeq = #{mbSeq}	
		<!-- <if test="shGender != null and !shGender.equals('')">AND mbGender = #{mbGender}</if> -->
		<choose>
			<when test="shOptionDate == 1">AND pmCreationDate BETWEEN #{shDateStart} AND #{shDateEnd} </when>
		</choose>
		
		<choose>
			<when test="shOption == 1">AND d.pdName LIKE CONCAT('%',#{shValue},'%')</when>
		</choose>
	</sql>
	
	<select id="selectList" resultMap="resultMapObj">
		SELECT
			a.mbSeq as memberSeq
			,b.pmSeq as paymentSeq
			,b.pmCreationDate
			,b.pmDeliveryStatus
			,b.mbSeq
			,c.pmSeq
			,c.pdSeq
			,d.pdSeq as productSeq
			,d.pdName
			,d.pdPrice
		<include refid="selectCommon"></include>
	</select>
	
	<select id="selectOneCount">
		SELECT COUNT(*)
		<include refid="selectCommon"></include>
	</select>
	
 	<select id="item" resultMap="resultMapObj">
    	SELECT
    		mbEmail
    		,mbDateBirth
    		,mbPassword
    		,mbName
    		,mbPhoneNumber
    	FROM member
        WHERE
        	mbSeq = #{mbSeq}
		</select>
		
	<update id="update">
		UPDATE member 
    	SET
    		mbName = #{mbName}
    		,mbDateBirth = #{mbDateBirth}
            ,mbGender = #{mbGender}
            ,mbEmail = #{mbEmail}
            ,mbPhoneNumber = #{mbPhoneNumber}
    	WHERE 1=1
    		AND mbSeq = #{mbSeq}
	</update>
</mapper>
